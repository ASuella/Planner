<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANNING POGGIO 2025</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    h1 {
        text-align: center;
        padding: 15px;
        background: linear-gradient(90deg, #1a73e8, #34a853);
        color: white;
        margin: 0;
    }
    table {
        border-collapse: collapse;
        margin: 20px auto;
        background: white;
        box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    th, td {
        border: 1px solid #ddd;
        text-align: center;
        padding: 4px;
        position: relative;
        min-width: 40px;
        height: 35px;
    }
    th {
        background: #f0f0f0;
        font-weight: bold;
    }
    .today {
        background-color: yellow !important;
    }
    .booking {
        position: absolute;
        top: 0;
        bottom: 0;
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        padding-left: 4px;
        border-radius: 4px;
        overflow: hidden;
        white-space: nowrap;
    }
    .past { background-color: #e74c3c; }
    .active { background-color: #2ecc71; }
    .future { background-color: #3498db; }
    .tooltip {
        display: none;
        position: absolute;
        background: #333;
        color: white;
        padding: 5px;
        font-size: 12px;
        border-radius: 4px;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        z-index: 999;
    }
    .booking:hover .tooltip {
        display: block;
    }
</style>
</head>
<body>

<h1>PLANNING POGGIO 2025</h1>
<div id="planner"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT32ylCoynwf1H44moYbc5n42UMdGEHUtzE6SZ7kc1P7rcwA-NkAEpck9jO0bVRWYRcakvb0VEd5cEJ/pub?gid=0&single=true&output=csv";

const startDate = new Date("2025-01-01");
const endDate = new Date("2025-12-31");
const today = new Date();

fetch(sheetUrl)
.then(res => res.text())
.then(csv => {
    const rows = csv.trim().split("\n").map(r => r.split(","));
    const bookings = [];
    for (let i = 1; i < rows.length; i++) {
        let [cliente, camera, checkinStr, nottiStr] = rows[i];
        let checkin = new Date(checkinStr);
        let notti = parseInt(nottiStr);
        let checkout = new Date(checkin);
        checkout.setDate(checkin.getDate() + notti);
        bookings.push({ cliente, camera, checkin, checkout, notti });
    }
    renderPlanner(bookings);
});

function renderPlanner(bookings) {
    const container = document.getElementById("planner");
    let html = "<table>";
    
    // Header con giorni
    html += "<tr><th>Camera</th>";
    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
        let dayClass = (sameDate(d, today)) ? "today" : "";
        html += `<th class="${dayClass}">${d.getDate()}</th>`;
    }
    html += "</tr>";

    // Camere
    const camere = ["Camera 1", "Camera 2", "Camera 3"];
    camere.forEach(camera => {
        html += `<tr><th>${camera}</th>`;
        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            html += `<td></td>`;
        }
        html += "</tr>";
    });

    html += "</table>";
    container.innerHTML = html;

    // Inserimento prenotazioni
    const table = container.querySelector("table");
    bookings.forEach(b => {
        let rowIndex = camere.indexOf(b.camera) + 1;
        if (rowIndex <= 0) return;
        let startOffset = Math.floor((b.checkin - startDate) / (1000*60*60*24));
        let length = Math.floor((b.checkout - b.checkin) / (1000*60*60*24));

        let colorClass = b.checkout < today ? "past" :
                         b.checkin > today ? "future" : "active";

        let row = table.rows[rowIndex];
        let startCell = row.cells[startOffset + 1];
        if (!startCell) return;

        let bookingDiv = document.createElement("div");
        bookingDiv.className = `booking ${colorClass}`;
        bookingDiv.style.left = "50%";
        bookingDiv.style.width = `${(length - 1) * 100 + 50}%`;
        bookingDiv.innerHTML = `${b.cliente} <span class="tooltip">${b.cliente} - ${b.camera}<br>Check-in: ${b.checkin.toLocaleDateString()}<br>Check-out: ${b.checkout.toLocaleDateString()}<br>Notti: ${b.notti}</span>`;

        startCell.appendChild(bookingDiv);
    });
}

function sameDate(d1, d2) {
    return d1.getFullYear() === d2.getFullYear() &&
           d1.getMonth() === d2.getMonth() &&
           d1.getDate() === d2.getDate();
}
</script>

</body>
</html>
