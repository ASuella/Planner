
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANNING POGGIO 2025</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
    }
    h1 {
        text-align: center;
        background: linear-gradient(90deg, #3b82f6, #06b6d4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 2.2em;
        padding: 20px 0;
    }
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid #ccc;
        text-align: center;
        padding: 0;
        position: relative;
        min-width: 28px;
    }
    th {
        background-color: #eee;
    }
    .day-column-today {
        background-color: rgba(255, 255, 0, 0.2);
    }
    .reservation {
        position: absolute;
        top: 0;
        bottom: 0;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border-radius: 6px;
        font-size: 0.9em;
        overflow: hidden;
        white-space: nowrap;
    }
    .past { background-color: #ef4444; }
    .present { background-color: #22c55e; }
    .future { background-color: #3b82f6; }
</style>
</head>
<body>
<h1>PLANNING POGGIO 2025</h1>
<div style="overflow-x:auto;">
<table id="planner"></table>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT32ylCoynwf1H44moYbc5n42UMdGEHUtzE6SZ7kc1P7rcwA-NkAEpck9jO0bVRWYRcakvb0VEd5cEJ/pub?gid=0&single=true&output=csv";

function loadPlanner() {
    fetch(sheetUrl)
    .then(res => res.text())
    .then(csv => {
        const rows = csv.trim().split("\n").map(r => r.split(","));
        renderPlanner(rows);
    });
}

function renderPlanner(data) {
    const table = document.getElementById("planner");
    table.innerHTML = "";

    const rooms = ["Camera 1", "Camera 2", "Camera 3"];
    const startDate = new Date("2025-01-01");
    const endDate = new Date("2025-12-31");
    const days = [];
    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate()+1)) {
        days.push(new Date(d));
    }

    // intestazione
    const header = document.createElement("tr");
    const thEmpty = document.createElement("th");
    header.appendChild(thEmpty);
    days.forEach(day => {
        const th = document.createElement("th");
        th.textContent = day.getDate();
        if (isToday(day)) th.classList.add("day-column-today");
        header.appendChild(th);
    });
    table.appendChild(header);

    // righe camere
    rooms.forEach(room => {
        const tr = document.createElement("tr");
        const tdRoom = document.createElement("td");
        tdRoom.textContent = room;
        tdRoom.style.fontWeight = "bold";
        tr.appendChild(tdRoom);

        days.forEach(() => {
            const td = document.createElement("td");
            tr.appendChild(td);
        });

        table.appendChild(tr);
    });

    // aggiunta prenotazioni
    for (let i = 1; i < data.length; i++) {
        const [cliente, camera, checkinStr, nottiStr] = data[i];
        const checkin = new Date(checkinStr);
        const notti = parseInt(nottiStr);
        const checkout = new Date(checkin);
        checkout.setDate(checkin.getDate() + notti);

        const today = new Date();
        let status = "future";
        if (checkout < today) status = "past";
        else if (checkin <= today && checkout >= today) status = "present";

        const roomIndex = rooms.indexOf(camera);
        if (roomIndex === -1) continue;

        const tr = table.rows[roomIndex + 1];
        let startIndex = days.findIndex(d => sameDay(d, checkin));
        let endIndex = days.findIndex(d => sameDay(d, checkout));

        if (startIndex === -1 || endIndex === -1) continue;

        const bar = document.createElement("div");
        bar.classList.add("reservation", status);
        bar.textContent = cliente.length > 6 ? cliente.split(" ").map(n => n[0]).join("") : cliente;

        // Calcolo posizione e larghezza
        bar.style.left = `calc(${startIndex * 100 / days.length}% + 50%)`;
        bar.style.width = `calc(${(endIndex - startIndex) * 100 / days.length}% - 50%)`;

        tr.cells[startIndex + 1].appendChild(bar);

        // Tooltip
        bar.title = `Cliente: ${cliente}\nCamera: ${camera}\nCheck-in: ${checkin.toLocaleDateString()}\nCheck-out: ${checkout.toLocaleDateString()}\nNotti: ${notti}`;
    }
}

function sameDay(d1, d2) {
    return d1.getFullYear() === d2.getFullYear() &&
           d1.getMonth() === d2.getMonth() &&
           d1.getDate() === d2.getDate();
}

function isToday(d) {
    const t = new Date();
    return d.getDate() === t.getDate() &&
           d.getMonth() === t.getMonth() &&
           d.getFullYear() === t.getFullYear();
}

loadPlanner();
setInterval(loadPlanner, 300000); // refresh ogni 5 minuti
</script>
</body>
</html>
