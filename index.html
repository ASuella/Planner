<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANNING POGGIO 2025</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 0;
    }
    h1 {
        text-align: center;
        font-size: 2.5rem;
        background: linear-gradient(90deg, #4facfe, #00f2fe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin: 20px 0;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        table-layout: fixed;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 5px;
        text-align: center;
        position: relative;
    }
    th {
        background-color: #f1f1f1;
    }
    .month-separator {
        background-color: #e6e6e6;
        font-weight: bold;
    }
    .booking {
        position: absolute;
        height: 80%;
        top: 10%;
        border-radius: 8px;
        color: white;
        font-size: 0.8rem;
        white-space: nowrap;
        overflow: hidden;
        padding-left: 4px;
        padding-right: 4px;
        display: flex;
        align-items: center;
    }
    .past { background-color: #e74c3c; }
    .present { background-color: #2ecc71; }
    .future { background-color: #3498db; }
    .today-highlight {
        background-color: rgba(255, 255, 0, 0.2);
    }
</style>
</head>
<body>
<h1>PLANNING POGGIO 2025</h1>
<div id="planner-container"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT32ylCoynwf1H44moYbc5n42UMdGEHUtzE6SZ7kc1P7rcwA-NkAEpck9jO0bVRWYRcakvb0VEd5cEJ/pub?gid=0&single=true&output=csv";

const today = new Date();
const year = 2025;

function loadPlanner(data) {
    const container = document.getElementById("planner-container");
    container.innerHTML = "";
    const rooms = ["Camera 1", "Camera 2", "Camera 3"];
    const table = document.createElement("table");

    // Header
    const headerRow = document.createElement("tr");
    const emptyTh = document.createElement("th");
    headerRow.appendChild(emptyTh);
    for (let month = 0; month < 12; month++) {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let day = 1; day <= daysInMonth; day++) {
            const th = document.createElement("th");
            th.textContent = day;
            if (day === today.getDate() && month === today.getMonth()) {
                th.classList.add("today-highlight");
            }
            headerRow.appendChild(th);
        }
    }
    table.appendChild(headerRow);

    // Rows per room
    rooms.forEach(room => {
        const row = document.createElement("tr");
        const roomCell = document.createElement("td");
        roomCell.textContent = room;
        row.appendChild(roomCell);

        for (let month = 0; month < 12; month++) {
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const td = document.createElement("td");
                if (day === today.getDate() && month === today.getMonth()) {
                    td.classList.add("today-highlight");
                }
                row.appendChild(td);
            }
        }

        table.appendChild(row);
    });

    container.appendChild(table);

    // Draw bookings
    data.forEach(booking => {
        const cliente = booking[0];
        const camera = booking[1];
        const checkIn = new Date(booking[2]);
        const notti = parseInt(booking[3]);
        const checkOut = new Date(checkIn);
        checkOut.setDate(checkOut.getDate() + notti);

        const roomIndex = rooms.indexOf(camera);
        if (roomIndex === -1) return;

        const startMonthDays = [...Array(checkIn.getMonth()).keys()].reduce((acc, m) => acc + new Date(year, m + 1, 0).getDate(), 0);
        const startDayIndex = startMonthDays + checkIn.getDate();
        const endMonthDays = [...Array(checkOut.getMonth()).keys()].reduce((acc, m) => acc + new Date(year, m + 1, 0).getDate(), 0);
        const endDayIndex = endMonthDays + checkOut.getDate();

        const row = table.rows[roomIndex + 1];
        const startCell = row.cells[startDayIndex];
        const bookingDiv = document.createElement("div");

        const now = new Date();
        if (checkOut < now) bookingDiv.classList.add("past");
        else if (checkIn > now) bookingDiv.classList.add("future");
        else bookingDiv.classList.add("present");

        bookingDiv.classList.add("booking");
        bookingDiv.textContent = cliente;
        bookingDiv.style.left = "50%";
        bookingDiv.style.width = `calc(${(endDayIndex - startDayIndex) * 100}% - 50%)`;
        startCell.appendChild(bookingDiv);
    });
}

fetch(sheetUrl)
    .then(res => res.text())
    .then(csv => {
        const rows = csv.trim().split("\n").map(r => r.split(","));
        rows.shift(); // remove header if present
        loadPlanner(rows);
    });

</script>
</body>
</html>
