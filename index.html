<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>PLANNING POGGIO 2025</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    h1 {
        text-align: center;
        font-size: 2em;
        padding: 20px;
        background: linear-gradient(to right, #4a90e2, #50e3c2);
        -webkit-background-clip: text;
        color: transparent;
    }
    .calendar {
        display: flex;
        flex-direction: column;
        padding: 10px;
    }
    .month {
        margin-bottom: 40px;
    }
    .month h2 {
        background-color: #ddd;
        padding: 5px;
        text-align: center;
        margin: 0;
    }
    .row {
        display: flex;
        align-items: center;
        border-bottom: 1px solid #ccc;
        min-height: 40px;
        position: relative;
    }
    .room-name {
        width: 100px;
        padding: 5px;
        background: #eee;
        border-right: 1px solid #ccc;
        font-weight: bold;
    }
    .days {
        flex: 1;
        display: flex;
    }
    .day {
        flex: 1;
        border-right: 1px solid #f0f0f0;
        position: relative;
    }
    .booking {
        position: absolute;
        top: 0;
        bottom: 0;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        border-radius: 5px;
        padding: 0 5px;
    }
    .past { background-color: #e74c3c; }
    .current { background-color: #2ecc71; }
    .future { background-color: #3498db; }
</style>
</head>
<body>

<h1>PLANNING POGGIO 2025</h1>
<div id="calendar" class="calendar"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT32ylCoynwf1H44moYbc5n42UMdGEHUtzE6SZ7kc1P7rcwA-NkAEpck9jO0bVRWYRcakvb0VEd5cEJ/pub?gid=0&single=true&output=csv";

async function caricaDati() {
    const response = await fetch(sheetUrl + "&t=" + new Date().getTime()); // cache-buster
    const csv = await response.text();
    const righe = csv.split("\n").map(r => r.split(","));
    righe.shift(); // rimuove intestazione

    // Prepara struttura dati prenotazioni
    const prenotazioni = righe.map(r => {
        return {
            cliente: r[0].trim(),
            camere: r[1].trim(),
            checkin: new Date(r[2].trim()),
            notti: parseInt(r[3].trim())
        };
    });

    disegnaCalendario(prenotazioni);
}

function disegnaCalendario(prenotazioni) {
    const calendarDiv = document.getElementById("calendar");
    calendarDiv.innerHTML = "";

    const rooms = [...new Set(prenotazioni.map(p => p.camere))];
    const startYear = 2025;
    const months = [
        "Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno",
        "Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"
    ];

    months.forEach((monthName, monthIndex) => {
        const monthDiv = document.createElement("div");
        monthDiv.className = "month";
        monthDiv.innerHTML = `<h2>${monthName}</h2>`;

        rooms.forEach(room => {
            const rowDiv = document.createElement("div");
            rowDiv.className = "row";

            const roomName = document.createElement("div");
            roomName.className = "room-name";
            roomName.textContent = room;
            rowDiv.appendChild(roomName);

            const daysDiv = document.createElement("div");
            daysDiv.className = "days";

            const daysInMonth = new Date(startYear, monthIndex+1, 0).getDate();
            for (let d = 1; d <= daysInMonth; d++) {
                const dayDiv = document.createElement("div");
                dayDiv.className = "day";
                daysDiv.appendChild(dayDiv);
            }

            // Aggiunge le prenotazioni
            prenotazioni.forEach(p => {
                if (p.camere === room && p.checkin.getMonth() === monthIndex) {
                    const startDay = p.checkin.getDate();
                    const bookingDiv = document.createElement("div");
                    bookingDiv.className = "booking";

                    // Determina colore in base alla data
                    const oggi = new Date();
                    const checkout = new Date(p.checkin);
                    checkout.setDate(checkout.getDate() + p.notti);

                    if (checkout < oggi) bookingDiv.classList.add("past");
                    else if (p.checkin <= oggi && checkout >= oggi) bookingDiv.classList.add("current");
                    else bookingDiv.classList.add("future");

                    bookingDiv.textContent = p.cliente;
                    bookingDiv.style.left = ((startDay-1) * (100/daysInMonth)) + "%";
                    bookingDiv.style.width = ((p.notti) * (100/daysInMonth)) + "%";
                    daysDiv.appendChild(bookingDiv);
                }
            });

            rowDiv.appendChild(daysDiv);
            monthDiv.appendChild(rowDiv);
        });

        calendarDiv.appendChild(monthDiv);
    });
}

// Carica dati iniziali
caricaDati();

// Aggiorna ogni 5 minuti
setInterval(caricaDati, 5 * 60 * 1000);
</script>

</body>
</html>
